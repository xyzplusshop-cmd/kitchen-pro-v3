generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  name      String?
  projects  Project[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Project {
  id             String   @id @default(uuid())
  name           String
  clientName     String?
  userId         String
  user           User     @relation(fields: [userId], references: [id])
  linearLength   Float    // Longitud total de la cocina lineal
  openingSystem  String   @default("HANDLE") // HANDLE, GOLA, PUSH
  defaultEdgeId  String?
  modules        Module[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Module {
  id            String   @id @default(uuid())
  projectId     String
  project       Project  @relation(fields: [projectId], references: [id])
  type          String   // BASE, WALL, TALL, SINK_BASE, DRAWER, etc.
  category      String   @default("BASE") // TOWER, BASE, WALL
  width         Float
  isFixed       Boolean  @default(false)
  doorCount     Int      @default(0)
  drawerCount   Int      @default(0)
  hingeType     String   @default("Estándar")
  sliderType    String   @default("Estándar")
  height        Float    @default(720)
  depth         Float    @default(560)
  openingSystem String?
  pieces        Piece[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Piece {
  id          String   @id @default(uuid())
  moduleId    String
  module      Module   @relation(fields: [moduleId], references: [id])
  name        String
  finalWidth  Float
  finalHeight Float
  cutWidth    Float
  cutHeight   Float
  materialId  String?
  material    Material? @relation(fields: [materialId], references: [id])
  
  // Cantos por lado (IDs de EdgeBand)
  edgeTopId    String?
  edgeBottomId String?
  edgeLeftId   String?
  edgeRightId  String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Material {
  id        String   @id @default(uuid())
  name      String
  thickness Float
  cost      Float
  pieces    Piece[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EdgeBand {
  id        String   @id @default(uuid())
  name      String
  thickness Float
  cost      Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
